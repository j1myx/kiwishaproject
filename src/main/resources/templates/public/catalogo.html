<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/base}">
<head>
    <title>Catálogo - Achisway</title>
</head>
<body>

<main layout:fragment="content">
    <div class="px-40 flex flex-1 justify-center py-5">
        <div class="layout-content-container flex flex-col max-w-[960px] flex-1">
                <!-- Breadcrumb -->
                <div class="flex flex-wrap gap-2 p-4">
                    <a class="text-[#9e7347] text-base font-medium leading-normal" th:href="@{/}">Inicio</a>
                    <span class="text-[#9e7347] text-base font-medium leading-normal">/</span>
                    <span class="text-[#1c140d] text-base font-medium leading-normal">Catálogo</span>
                </div>

                <!-- Filtros (simple: búsqueda, categoría, ordenar) -->
                <form th:action="@{/catalogo}" method="get" class="px-4">
                    <input type="hidden" name="pagina" value="0" />
                    <div class="grid grid-cols-1 gap-3 @[640px]:grid-cols-3">
                        <label class="flex flex-col min-w-40 h-12 w-full @[640px]:col-span-1">
                            <div class="flex w-full flex-1 items-stretch rounded-lg h-full">
                                <div class="text-[#9e7347] flex border-none bg-[#f4ede6] items-center justify-center pl-4 rounded-l-lg border-r-0">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="24px" height="24px" fill="currentColor" viewBox="0 0 256 256">
                                        <path d="M229.66,218.34l-50.07-50.06a88.11,88.11,0,1,0-11.31,11.31l50.06,50.07a8,8,0,0,0,11.32-11.32ZM40,112a72,72,0,1,1,72,72A72.08,72.08,0,0,1,40,112Z"></path>
                                    </svg>
                                </div>
                                <input name="busqueda" th:value="${busqueda}" placeholder="Buscar productos"
                                       class="form-input flex w-full min-w-0 flex-1 resize-none overflow-hidden rounded-lg text-[#1c140d] focus:outline-0 focus:ring-0 border-none bg-[#f4ede6] focus:border-none h-full placeholder:text-[#9e7347] px-4 rounded-l-none border-l-0 pl-2 text-base font-normal leading-normal" />
                            </div>
                        </label>

                        <label class="flex flex-col min-w-40 h-12 w-full">
                            <select name="categoriaId"
                                    class="form-input flex w-full min-w-0 flex-1 resize-none overflow-hidden rounded-lg text-[#1c140d] focus:outline-0 focus:ring-0 border border-[#e9dbce] bg-[#fcfaf8] focus:border-[#e9dbce] h-12 placeholder:text-[#9e7347] px-3 text-base font-normal leading-normal">
                                <option value="" th:selected="${categoriaSeleccionada == null}">Todas las categorías</option>
                                <option th:each="categoria : ${categorias}"
                                        th:value="${categoria.categoriaId}"
                                        th:selected="${categoriaSeleccionada != null and categoriaSeleccionada == categoria.categoriaId}"
                                    th:text="${categoria.titulo}">Categoría</option>
                            </select>
                        </label>

                        <label class="flex flex-col min-w-40 h-12 w-full">
                            <select name="ordenar"
                                    class="form-input flex w-full min-w-0 flex-1 resize-none overflow-hidden rounded-lg text-[#1c140d] focus:outline-0 focus:ring-0 border border-[#e9dbce] bg-[#fcfaf8] focus:border-[#e9dbce] h-12 placeholder:text-[#9e7347] px-3 text-base font-normal leading-normal">
                                <option value="" th:selected="${ordenar == null or ordenar == ''}">Más recientes</option>
                                <option th:value="precio_asc" th:selected="${ordenar == 'precio_asc'}">Precio: menor a mayor</option>
                                <option th:value="precio_desc" th:selected="${ordenar == 'precio_desc'}">Precio: mayor a menor</option>
                                <option th:value="nombre" th:selected="${ordenar == 'nombre'}">Nombre A-Z</option>
                            </select>
                        </label>
                    </div>

                    <div class="flex justify-end pt-3">
                        <button type="submit"
                                class="flex min-w-[84px] max-w-[480px] cursor-pointer items-center justify-center overflow-hidden rounded-lg h-10 px-4 bg-[#f98006] text-[#1c140d] text-sm font-bold leading-normal tracking-[0.015em] hover:bg-[#e07305]">
                            <span class="truncate">Aplicar</span>
                        </button>
                    </div>
                </form>

                <!-- Grid productos -->
                <div class="grid grid-cols-[repeat(auto-fit,minmax(158px,1fr))] gap-3 p-4">
                    <a th:each="producto : ${productos.content}"
                       th:href="@{/producto/{slug}(slug=${producto.slug})}"
                       class="flex flex-col gap-3 pb-3">
                        <div class="w-full bg-center bg-no-repeat aspect-square bg-cover rounded-lg"
                                th:with="img=${producto.imagen != null and !#strings.isEmpty(producto.imagen) ? (#strings.startsWith(producto.imagen,'http') ? producto.imagen : '/files/' + producto.imagen) : '/files/defaults/producto-default.svg'}"
                             th:style="'background-image: url(' + ${img} + ');'"></div>
                        <div>
                            <p class="text-[#1c140d] text-base font-medium leading-normal" th:text="${producto.titulo}">Producto</p>
                            <p class="text-[#9e7347] text-sm font-normal leading-normal"
                               th:text="${producto.resumen != null and !#strings.isEmpty(producto.resumen) ? producto.resumen : producto.descripcion}">Descripción</p>
                            <p class="text-[#9e7347] text-sm font-normal leading-normal">
                                S/ <span th:text="${producto.precio != null ? #numbers.formatDecimal(producto.precio, 1, 2) : '0.00'}">0.00</span>
                            </p>
                        </div>
                    </a>
                </div>

                <!-- Paginación -->
                <div th:if="${productos.totalPages > 1}" class="flex items-center justify-center p-4"
                     th:with="start=${T(java.lang.Math).max(0, productos.number-1)}, end=${T(java.lang.Math).min(productos.totalPages-1, productos.number+1)}">
                    <a th:if="${productos.number > 0}"
                       th:href="@{/catalogo(pagina=${productos.number - 1}, categoriaId=${categoriaSeleccionada}, busqueda=${busqueda}, ordenar=${ordenar})}"
                       class="flex size-10 items-center justify-center">
                        <div class="text-[#1c140d]">
                            <svg xmlns="http://www.w3.org/2000/svg" width="18px" height="18px" fill="currentColor" viewBox="0 0 256 256">
                                <path d="M165.66,202.34a8,8,0,0,1-11.32,11.32l-80-80a8,8,0,0,1,0-11.32l80-80a8,8,0,0,1,11.32,11.32L91.31,128Z"></path>
                            </svg>
                        </div>
                    </a>

                    <a th:each="i : ${#numbers.sequence(start, end)}"
                       th:href="@{/catalogo(pagina=${i}, categoriaId=${categoriaSeleccionada}, busqueda=${busqueda}, ordenar=${ordenar})}"
                       th:class="${i == productos.number ? 'text-sm font-bold leading-normal tracking-[0.015em] flex size-10 items-center justify-center text-[#1c140d] rounded-full bg-[#f4ede6]' : 'text-sm font-normal leading-normal flex size-10 items-center justify-center text-[#1c140d] rounded-full'}"
                       th:text="${i + 1}">1</a>

                    <a th:if="${productos.number < productos.totalPages - 1}"
                       th:href="@{/catalogo(pagina=${productos.number + 1}, categoriaId=${categoriaSeleccionada}, busqueda=${busqueda}, ordenar=${ordenar})}"
                       class="flex size-10 items-center justify-center">
                        <div class="text-[#1c140d]">
                            <svg xmlns="http://www.w3.org/2000/svg" width="18px" height="18px" fill="currentColor" viewBox="0 0 256 256">
                                <path d="M90.34,53.66a8,8,0,0,1,11.32-11.32l80,80a8,8,0,0,1,0,11.32l-80,80a8,8,0,0,1-11.32-11.32L164.69,128Z"></path>
                            </svg>
                        </div>
                    </a>
                </div>
            </div>
        </div>

</main>

</body>
</html>
