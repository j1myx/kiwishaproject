<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/base}">
<head>
    <title>Checkout - Achisway</title>
</head>
<body>

<main layout:fragment="content">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8"
         style="--checkbox-tick-svg: url('data:image/svg+xml,%3csvg viewBox=%270 0 16 16%27 fill=%27rgb(28,20,13)%27 xmlns=%27http://www.w3.org/2000/svg%27%3e%3cpath d=%27M12.207 4.793a1 1 0 010 1.414l-5 5a1 1 0 01-1.414 0l-2-2a1 1 0 011.414-1.414L6.5 9.086l4.293-4.293a1 1 0 011.414 0z%27/%3e%3c/svg%3e'); --radio-dot-svg: url('data:image/svg+xml,%3csvg viewBox=%270 0 16 16%27 fill=%27rgb(249,128,6)%27 xmlns=%27http://www.w3.org/2000/svg%27%3e%3ccircle cx=%278%27 cy=%278%27 r=%273%27/%3e%3c/svg%3e');">

        <div th:if="${#lists.isEmpty(itemsCarrito)}" class="text-center py-16">
            <p class="text-xl text-gray-600 mb-8">Tu carrito está vacío</p>
            <a th:href="@{/catalogo}" class="bg-purple-600 text-white px-8 py-3 rounded-lg hover:bg-purple-700 transition">
                Ver Catálogo
            </a>
        </div>

        <div th:unless="${#lists.isEmpty(itemsCarrito)}" class="grid grid-cols-1 lg:grid-cols-3 gap-6">

            <!-- Formulario -->
            <div class="lg:col-span-2">
                <div class="bg-white rounded-lg shadow p-6">
                    <div class="flex flex-wrap gap-2 mb-4">
                        <a class="text-[#9e7347] text-base font-medium leading-normal" th:href="@{/carrito}">Carrito</a>
                        <span class="text-[#9e7347] text-base font-medium leading-normal">/</span>
                        <span class="text-[#1c140d] text-base font-medium leading-normal">Checkout</span>
                    </div>

                    <h1 class="text-2xl font-bold text-[#1c140d] mb-2">Checkout</h1>

                    <div class="flex flex-col gap-3 mb-6">
                        <div class="flex gap-6 justify-between">
                            <p class="text-[#1c140d] text-base font-medium leading-normal">Paso 1 de 3</p>
                        </div>
                        <div class="rounded bg-[#e9dbce]"><div class="h-2 rounded bg-[#f98006]" style="width: 33%;"></div></div>
                    </div>

                    <form th:action="@{/checkout/procesar}" method="post" th:object="${datosCheckout}" class="space-y-4">
                        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <label class="flex flex-col">
                                <span class="text-[#1c140d] text-base font-medium leading-normal pb-2">Nombre</span>
                                <input th:field="*{nombre}" placeholder="Ingresa tu nombre"
                                       class="form-input w-full rounded-lg text-[#1c140d] border border-[#e9dbce] bg-[#fcfaf8] focus:border-[#e9dbce] h-12 placeholder:text-[#9e7347] px-3" />
                            </label>

                            <label class="flex flex-col">
                                <span class="text-[#1c140d] text-base font-medium leading-normal pb-2">Apellido</span>
                                <input th:field="*{apellido}" placeholder="Ingresa tu apellido"
                                       class="form-input w-full rounded-lg text-[#1c140d] border border-[#e9dbce] bg-[#fcfaf8] focus:border-[#e9dbce] h-12 placeholder:text-[#9e7347] px-3" />
                            </label>
                        </div>

                        <label class="flex flex-col">
                            <span class="text-[#1c140d] text-base font-medium leading-normal pb-2">Email</span>
                            <input th:field="*{email}" type="email" placeholder="Ingresa tu email"
                                   class="form-input w-full rounded-lg text-[#1c140d] border border-[#e9dbce] bg-[#fcfaf8] focus:border-[#e9dbce] h-12 placeholder:text-[#9e7347] px-3" />
                        </label>

                        <label class="flex flex-col">
                            <span class="text-[#1c140d] text-base font-medium leading-normal pb-2">Teléfono</span>
                            <input th:field="*{telefono}" placeholder="Ingresa tu teléfono"
                                   class="form-input w-full rounded-lg text-[#1c140d] border border-[#e9dbce] bg-[#fcfaf8] focus:border-[#e9dbce] h-12 placeholder:text-[#9e7347] px-3" />
                        </label>

                        <label class="flex flex-col">
                            <span class="text-[#1c140d] text-base font-medium leading-normal pb-2">Dirección</span>
                            <input th:field="*{direccion}" placeholder="Ingresa tu dirección"
                                   class="form-input w-full rounded-lg text-[#1c140d] border border-[#e9dbce] bg-[#fcfaf8] focus:border-[#e9dbce] h-12 placeholder:text-[#9e7347] px-3" />
                        </label>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <label class="flex flex-col">
                                <span class="text-[#1c140d] text-base font-medium leading-normal pb-2">Ciudad</span>
                                <input th:field="*{ciudad}" placeholder="Ingresa tu ciudad"
                                       class="form-input w-full rounded-lg text-[#1c140d] border border-[#e9dbce] bg-[#fcfaf8] focus:border-[#e9dbce] h-12 placeholder:text-[#9e7347] px-3" />
                            </label>
                            <label class="flex flex-col">
                                <span class="text-[#1c140d] text-base font-medium leading-normal pb-2">Código postal</span>
                                <input th:field="*{codigoPostal}" placeholder="Ingresa tu código postal"
                                       class="form-input w-full rounded-lg text-[#1c140d] border border-[#e9dbce] bg-[#fcfaf8] focus:border-[#e9dbce] h-12 placeholder:text-[#9e7347] px-3" />
                            </label>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <label class="flex flex-col">
                                <span class="text-[#1c140d] text-base font-medium leading-normal pb-2">Provincia</span>
                                <input th:field="*{provincia}" placeholder="Ingresa tu provincia"
                                       class="form-input w-full rounded-lg text-[#1c140d] border border-[#e9dbce] bg-[#fcfaf8] focus:border-[#e9dbce] h-12 placeholder:text-[#9e7347] px-3" />
                            </label>
                            <label class="flex flex-col">
                                <span class="text-[#1c140d] text-base font-medium leading-normal pb-2">País</span>
                                <input th:field="*{pais}" placeholder="Perú"
                                       class="form-input w-full rounded-lg text-[#1c140d] border border-[#e9dbce] bg-[#fcfaf8] focus:border-[#e9dbce] h-12 placeholder:text-[#9e7347] px-3" />
                            </label>
                        </div>

                        <h2 class="text-[#1c140d] text-lg font-bold leading-tight tracking-[-0.015em] pt-2">Método de envío</h2>
                        <div class="flex flex-col gap-3">
                            <label class="flex items-center gap-4 rounded-lg border border-solid border-[#e9dbce] p-[15px]">
                                <input type="radio" name="metodoEnvioId" value="1"
                                       th:checked="${datosCheckout.metodoEnvioId == null || datosCheckout.metodoEnvioId == 1}"
                                       class="h-5 w-5 border-2 border-[#e9dbce] bg-transparent text-transparent checked:border-[#f98006] checked:bg-[image:--radio-dot-svg] focus:outline-none focus:ring-0 focus:ring-offset-0 checked:focus:border-[#f98006]" />
                                <div class="flex grow flex-col">
                                    <p class="text-[#1c140d] text-sm font-medium leading-normal">Envío estándar</p>
                                    <p class="text-[#9e7347] text-sm font-normal leading-normal">5-7 días hábiles</p>
                                </div>
                            </label>
                            <label class="flex items-center gap-4 rounded-lg border border-solid border-[#e9dbce] p-[15px]">
                                <input type="radio" name="metodoEnvioId" value="2"
                                       th:checked="${datosCheckout.metodoEnvioId != null && datosCheckout.metodoEnvioId == 2}"
                                       class="h-5 w-5 border-2 border-[#e9dbce] bg-transparent text-transparent checked:border-[#f98006] checked:bg-[image:--radio-dot-svg] focus:outline-none focus:ring-0 focus:ring-offset-0 checked:focus:border-[#f98006]" />
                                <div class="flex grow flex-col">
                                    <p class="text-[#1c140d] text-sm font-medium leading-normal">Envío express</p>
                                    <p class="text-[#9e7347] text-sm font-normal leading-normal">2-3 días hábiles</p>
                                </div>
                            </label>
                        </div>

                        <label class="flex gap-x-3 py-2 flex-row items-start">
                            <input th:field="*{aceptaTerminos}" type="checkbox"
                                   class="h-5 w-5 rounded border-[#e9dbce] border-2 bg-transparent text-[#f98006] checked:bg-[#f98006] checked:border-[#f98006] checked:bg-[image:--checkbox-tick-svg] focus:ring-0 focus:ring-offset-0 focus:border-[#e9dbce] focus:outline-none" />
                            <span class="text-[#1c140d] text-base font-normal leading-normal">Acepto los términos y condiciones</span>
                        </label>

                        <label class="flex flex-col">
                            <span class="text-[#1c140d] text-base font-medium leading-normal pb-2">Notas (opcional)</span>
                            <textarea th:field="*{notas}" rows="3" placeholder="Indicaciones adicionales"
                                      class="form-input w-full rounded-lg text-[#1c140d] border border-[#e9dbce] bg-[#fcfaf8] focus:border-[#e9dbce] placeholder:text-[#9e7347] px-3 py-2"></textarea>
                        </label>

                        <div class="flex flex-wrap gap-3 justify-between pt-2">
                            <a th:href="@{/carrito}"
                               class="inline-flex items-center justify-center rounded-lg h-10 px-4 bg-[#f4ede6] text-[#1c140d] text-sm font-bold leading-normal tracking-[0.015em]">
                                Volver al carrito
                            </a>
                            <button type="submit"
                                    class="inline-flex items-center justify-center rounded-lg h-10 px-4 bg-[#f98006] text-[#1c140d] text-sm font-bold leading-normal tracking-[0.015em]">
                                Continuar a pago
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Resumen -->
            <div class="lg:col-span-1">
                <div class="bg-white rounded-lg shadow p-6 sticky top-20">
                    <h2 class="text-[#1c140d] text-lg font-bold leading-tight tracking-[-0.015em] pb-2">Resumen del pedido</h2>

                    <div class="flex flex-col gap-3 max-h-[420px] overflow-auto pr-1">
                        <div th:each="item : ${itemsCarrito}" class="flex items-center gap-4 bg-[#fcfaf8] rounded-lg p-3 border border-[#f4ede6]">
                            <img th:src="@{${(item.productoImagen != null and !#strings.isEmpty(item.productoImagen)) ? '/files/' + item.productoImagen : '/files/defaults/producto-default.svg'}}"
                                 onerror="this.onerror=null; this.src='/files/defaults/producto-default.svg';"
                                 th:alt="${item.productoTitulo}"
                                 class="w-14 h-14 object-cover rounded-lg" />
                            <div class="flex flex-col justify-center min-w-0">
                                <p class="text-[#1c140d] text-base font-medium leading-normal truncate" th:text="${item.productoTitulo}">Producto</p>
                                <p class="text-[#9e7347] text-sm font-normal leading-normal" th:text="${item.cantidad + ' x S/ ' + #numbers.formatDecimal(item.precio, 1, 2)}">1 x S/ 0.00</p>
                            </div>
                        </div>
                    </div>

                    <div class="pt-4">
                        <div class="flex justify-between gap-x-6 py-2">
                            <p class="text-[#9e7347] text-sm font-normal leading-normal">Subtotal</p>
                            <p class="text-[#1c140d] text-sm font-normal leading-normal text-right">S/ <span th:text="${#numbers.formatDecimal(carrito.subtotal, 1, 2)}">0.00</span></p>
                        </div>
                        <div class="flex justify-between gap-x-6 py-2">
                            <p class="text-[#9e7347] text-sm font-normal leading-normal">Envío</p>
                            <p class="text-[#1c140d] text-sm font-normal leading-normal text-right">Calculado al pagar</p>
                        </div>
                        <div class="flex justify-between gap-x-6 py-2 border-t border-[#e9dbce] mt-2 pt-3">
                            <p class="text-[#9e7347] text-sm font-normal leading-normal">Total (sin envío)</p>
                            <p class="text-[#1c140d] text-sm font-normal leading-normal text-right">S/ <span th:text="${#numbers.formatDecimal(carrito.total, 1, 2)}">0.00</span></p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</main>

</body>
</html>
